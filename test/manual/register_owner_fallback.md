# اختبار يدوي: تسجيل مالك جديد عند تعطل Edge Function

يهدف هذا الاختبار إلى التأكد من أن الاستدعاء الاحتياطي `admin_bootstrap_clinic_for_email`
يعمل بشكلٍ صحيح عند فشل وظائف Edge المسؤولة عن إنشاء العيادة والمالك.

## التحضير
1. افتح مشروع Supabase المرتبط بالبيئة المراد اختبارها.
2. عدّل وظيفة Edge `admin__create_clinic_owner` (أو أي اسم بديل مستخدم)
   لتُرجِع خطأً صريحًا، مثل:
   ```ts
   export default async function handler(req: Request) {
     return new Response('forced failure', { status: 500 });
   }
   ```
   ثم أعد نشر الوظيفة أو استخدم `supabase functions serve` لحقن الفشل.
3. تحقّق من أن استدعاء الوظيفة يُرجع حالة فشل عبر الأمر:
   ```bash
   supabase functions invoke admin__create_clinic_owner
   ```
   (أو الاسم الفعلي للوظيفة المستخدمة في البيئة).

## الخطوات
1. شغّل التطبيق باستخدام حساب Super Admin:
   ```bash
   flutter run -t lib/main_dev.dart
   ```
2. من شاشة الإدارة → "العيادات"، أنشئ عيادة جديدة واملأ البيانات التالية:
   - اسم العيادة: قيمة تجريبية (مثلاً `Fallback Clinic`).
   - بريد المالك: بريد تجريبي جديد لم يُستخدم سابقًا.
   - كلمة مرور المالك: كلمة مرور مؤقتة.
3. أرسل الطلب ولاحظ أن العملية تنجح رغم فشل وظيفة Edge (يُفترض ظهور إشعار نجاح
   في التطبيق وعدم ظهور أخطاء 5xx).
4. في لوحة Supabase → Database → Table editor، تحقّق من إضافة سجل جديد في
   جدول `clinics` وربطه بمالك جديد في جدول `account_users`.

## النتيجة المتوقعة
- يُسجَّل المالك الجديد بنجاح ويُنشأ حساب العيادة.
- لا تظهر أي أخطاء في الواجهة، وتُسجِّل السجلات خريطة الاستدعاء الاحتياطي
  (`admin_bootstrap_clinic_for_email`).
- يمكن تسجيل الدخول بالبريد الجديد للتأكد من اكتمال الإعداد.
